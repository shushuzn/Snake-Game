<!doctype html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>贪吃蛇游戏</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="topbar">
        <h1>🐍 Snake 控制台 <small id="versionTag">v1.2.0</small></h1>
        <div class="hud-grid" aria-label="游戏状态">
          <span>分数 <b id="score">0</b></span>
          <span>最高 <b id="best">0</b></span>
          <span>模式高 <b id="modeBest">0</b></span>
          <span>长度 <b id="length">3</b></span>
          <span>时间 <b id="time" class="warn">--</b></span>
          <span>关卡 <b id="level">--</b></span>
          <span>最高关 <b id="bestLevel">0</b></span>
          <span>肉鸽点 <b id="roguePerks">0</b></span>
          <span>词条 <b id="rogueMutator">--</b></span>
          <span>连击 <b id="combo">x1</b></span>
          <span>护盾 <b id="shield">0</b></span>
          <span>任务 <b id="mission">--</b></span>
          <span>总局 <b id="plays">0</b></span>
          <span>吃到 <b id="foods">0</b></span>
          <span>连胜 <b id="streak">0</b></span>
          <span>成就 <b id="achievements">0/8</b></span>
          <span>签到 <b id="dailyStreak">未签到</b></span>
          <span>等级 <b id="playerLevel">1</b></span>
          <span>经验 <div id="expBar" class="exp-bar"><div id="expProgress" class="exp-progress"></div></div></span>
          <span>挑战 <b id="challenge">--</b></span>
          <span>挑战效果 <b id="challengeDetail">--</b></span>
          <span>明日挑战 <b id="challengeNext">--</b></span>
          <span>明日日期 <b id="challengeNextDate">--</b></span>
          <span>挑战刷新 <b id="challengeRefresh">--</b></span>
          <span>挑战日期 <b id="challengeDate">--</b></span>
          <span>上局 <b id="lastResult">--</b></span>
          <span>倍率 <b id="multiplier">x1</b></span>
          <span>DLC <b id="dlcStatus">关闭</b></span>
          <span>状态 <b id="state">正常</b></span>
        </div>
      </header>

      <section class="board-panel">
        <div class="board-wrap">
          <canvas id="board" width="500" height="500" aria-label="贪吃蛇棋盘"></canvas>
          <div class="overlay" id="overlay">
            <div>
              <p><strong>按方向键开始游戏</strong></p>
              <p>支持方向键 / WASD / 触屏方向键 / 滑动</p>
            </div>
          </div>
        </div>
        <p class="tips">Space / P 暂停，R 重开，M 静音，H 帮助；可切换模式、难度、皮肤与高对比显示。</p>
      </section>

      <section class="control-panel" aria-label="游戏控制">
        <div class="controls-group action-row">
          <button id="restart" type="button">重新开始</button>
          <button id="pause" type="button" class="secondary">暂停</button>
          <button id="clearData" type="button" class="secondary">清空记录</button>
          <button id="mute" type="button" class="secondary">🔊 音效开</button>
          <button id="share" type="button" class="secondary">复制战绩</button>
          <button id="claimDaily" type="button" class="secondary">🎁 签到</button>
          <button id="help" type="button" class="secondary">帮助</button>
          <button id="tutorial" type="button" class="secondary">新手引导</button>
        </div>

        <div class="controls-group setting-row">
          <label class="label-inline" for="mode">模式
            <select id="mode"><option value="classic" selected>经典</option><option value="timed">限时 60 秒</option><option value="blitz">冲刺 45 秒</option><option value="endless">无尽关卡</option><option value="roguelike">肉鸽模式</option></select>
          </label>
          <label class="label-inline" for="difficulty">难度
            <select id="difficulty"><option value="140">悠闲</option><option value="110" selected>标准</option><option value="80">极速</option></select>
          </label>
          <label class="label-inline" for="skin">皮肤
            <select id="skin"><option value="classic" selected>经典绿</option><option value="neon">霓虹紫</option><option value="sunset">日落橙</option><option value="pixel">像素青</option></select>
          </label>
          <label class="label-inline" for="dlcPack">DLC
            <select id="dlcPack"><option value="none" selected>关闭</option><option value="frenzy">狂热扩展</option><option value="guardian">守护扩展</option><option value="chrono">时序扩展</option></select>
          </label>
          <label class="label-inline compact" for="wrapMode"><input id="wrapMode" type="checkbox" />穿墙</label>
          <label class="label-inline compact" for="obstacleMode"><input id="obstacleMode" type="checkbox" checked />障碍</label>
          <label class="label-inline compact" for="hardcoreMode"><input id="hardcoreMode" type="checkbox" />硬核</label>
          <label class="label-inline compact" for="contrastMode"><input id="contrastMode" type="checkbox" />高对比</label>
          <label class="label-inline compact" for="miniHudMode"><input id="miniHudMode" type="checkbox" />精简HUD</label>
          <label class="label-inline compact" for="autoPauseMode"><input id="autoPauseMode" type="checkbox" checked />失焦自动暂停</label>
          <label class="label-inline" for="swipeThreshold">滑动灵敏度
            <select id="swipeThreshold"><option value="12">高（12px）</option><option value="18" selected>标准（18px）</option><option value="24">低（24px）</option><option value="32">很低（32px）</option></select>
          </label>
        </div>
      </section>

      <section class="panel" aria-label="本地账号">
        <h2>本地账号</h2>
        <div class="controls-group account-row">
          <span>当前：<b id="accountName">游客</b></span>
          <input id="accountInput" type="text" placeholder="输入账号名" maxlength="20" />
          <button id="loginAccount" type="button" class="secondary">登录/切换</button>
          <button id="logoutAccount" type="button" class="secondary">退出账号</button>
          <button id="exportSave" type="button" class="secondary">导出存档</button>
          <label class="file-btn" for="importSave">导入存档</label>
          <input id="importSave" type="file" accept="application/json" />
        </div>
      </section>


      <section class="panel" aria-label="创意工坊">
        <h2>创意工坊（规则分享）</h2>
        <p class="tips">生成当前规则代码分享给好友，或粘贴代码一键应用。</p>
        <textarea id="workshopCode" class="workshop-code" rows="3" placeholder="粘贴创意工坊代码"></textarea>
        <div class="controls-group">
          <label class="label-inline" for="workshopPreset">预设
            <select id="workshopPreset">
              <option value="">选择工坊预设</option>
              <option value="timed-rush">限时冲分</option>
              <option value="rogue-hardcore">肉鸽硬核</option>
              <option value="endless-relax">无尽练习</option>
            </select>
          </label>
          <button id="applyWorkshopPreset" type="button" class="secondary">应用预设</button>
        </div>
        <div class="controls-group">
          <button id="genWorkshop" type="button" class="secondary">生成代码</button>
          <button id="copyWorkshop" type="button" class="secondary">复制代码</button>
          <button id="applyWorkshop" type="button">应用代码</button>
        </div>
      </section>

      <section class="panel" aria-label="障碍编辑器">
        <h2>障碍编辑器（实验）</h2>
        <p class="tips">每行一个坐标：<code>x,y</code>（范围 0-24），可导出当前障碍布局。</p>
        <p class="tips" id="mapSummary">地图摘要：--</p>
        <textarea id="rockEditor" class="workshop-code" rows="4" placeholder="例如：
12,8
13,8
14,8"></textarea>
        <div class="controls-group">
          <button id="applyRocks" type="button" class="secondary">应用障碍</button>
          <button id="exportRocks" type="button" class="secondary">导出当前障碍</button>
          <button id="genMapCode" type="button" class="secondary">生成地图码</button>
          <button id="copyMapCode" type="button">复制地图码</button>
          <button id="applyMapCode" type="button" class="secondary">应用地图码</button>
          <button id="clearRocks" type="button">清空自定义障碍</button>
          <button id="genRandomRocks" type="button" class="secondary">🎲 随机障碍</button>
        </div>
      </section>

      <section class="panel" id="helpPanel" aria-label="玩法帮助" style="display:none;">
        <h2>玩法帮助</h2>
        <ol>
          <li><strong>模式</strong>：经典稳扎稳打；限时拼效率；无尽冲关；肉鸽每局随机词条。</li>
          <li><strong>控制</strong>：方向键 / WASD / 触屏方向键 / 滑动，Space/P 暂停，R 重开，M 静音，H 帮助。</li>
          <li><strong>道具</strong>：护盾果保命、倍率果提分、磁力果吸附、连击果护航连击；连击达 x5/x8 还有里程奖励。</li>
          <li><strong>建议</strong>：优先任务拿护盾，保持连击，注意高分后障碍增长。</li>
        </ol>
        <div class="controls-group"><button id="closeHelp" type="button" class="secondary">关闭帮助</button></div>
      </section>

      <div class="mobile-pad" aria-label="移动控制">
        <button class="empty" tabindex="-1"></button>
        <button data-dir="ArrowUp" aria-label="上">⬆️</button>
        <button class="empty" tabindex="-1"></button>
        <button data-dir="ArrowLeft" aria-label="左">⬅️</button>
        <button data-dir="ArrowDown" aria-label="下">⬇️</button>
        <button data-dir="ArrowRight" aria-label="右">➡️</button>
      </div>


      <section class="panel" aria-label="本地排行榜">
        <h2>排行榜（Top 20，本地/远端）</h2>
        <p class="tips" id="leaderboardStatus">本地榜：暂无数据</p>
        <div class="controls-group">
          <button id="toggleLeaderboardSource" type="button" class="secondary">切换到远端榜</button>
          <span class="tips" id="leaderboardSourceTag">当前来源：本地榜</span>
        </div>
        <div class="controls-group">
          <label class="label-inline" for="leaderboardDimension">榜单维度
            <select id="leaderboardDimension">
              <option value="all" selected>综合榜</option>
              <option value="classic">经典榜</option>
              <option value="timed">限时榜</option>
              <option value="blitz">冲刺榜</option>
              <option value="endless">无尽榜</option>
              <option value="roguelike">肉鸽榜</option>
              <option value="daily">每日挑战榜</option>
              <option value="dlc-frenzy">DLC-狂热榜</option>
              <option value="dlc-guardian">DLC-守护榜</option>
              <option value="dlc-chrono">DLC-时序榜</option>
            </select>
          </label>
        </div>
        <ol id="leaderboardList"></ol>
      </section>


      <section class="panel" aria-label="赛季信息">
        <h2>赛季信息</h2>
        <p class="tips">当前赛季 <b id="seasonId">--</b>，剩余 <b id="seasonRemaining">--</b></p>
        <p class="tips">赛季最佳：<b id="seasonBest">--</b></p>
        <p class="tips">赛季奖励预览：<b id="seasonReward">--</b></p>
        <h3>历史赛季（最近 6 期）</h3>
        <ol id="seasonHistoryList"></ol>
      </section>


      <section class="panel" id="eventPanel" aria-label="活动挑战包">
        <h2>活动挑战包</h2>
        <p class="tips">当前活动：<b id="eventLabel">无活动</b></p>
        <p class="tips" id="eventSummary">当前无活动加成</p>
      </section>

      <section class="panel" aria-label="最近战绩">
        <h2>最近战绩（最近 5 局）</h2>
        <ol id="historyList"></ol>
      </section>

      <section class="panel" aria-label="道具图鉴">
        <h2>道具图鉴（已发现 <b id="codexProgress">0/10</b>）</h2>
        <ol id="codexList"></ol>
      </section>



      <section class="panel" aria-label="对局复盘摘要">
        <h2>对局复盘摘要（最近一局）</h2>
        <p class="tips" id="recapSummary">暂无复盘数据</p>
        <ul id="recapList"></ul>
        <h3>关键帧时间线</h3>
        <ol id="recapTimelineList"></ol>
      </section>

      <section class="panel" aria-label="结算明细">
        <h2>结算明细（最近一局）</h2>
        <ul id="settlementList"></ul>
      </section>


      <section class="panel" aria-label="DLC 风险收益对比">
        <h2>DLC 风险收益对比（阶段 2）</h2>
        <ul id="dlcCompareList"></ul>
      </section>

      <section class="panel" aria-label="版本大事件">
        <h2>版本大事件（最近 8 条）</h2>
        <div class="controls-group">
          <button id="jumpToEventPanel" type="button" class="secondary">活动入口：跳转到活动面板</button>
        </div>
        <ol id="versionEventsList"></ol>
      </section>
    </main>

    <script src="src/modules/workshop.js"></script>
    <script src="src/modules/storage.js"></script>
    <script src="src/modules/modes.js"></script>
    <script src="src/modules/challenge.js"></script>
    <script src="src/modules/account.js"></script>
    <script src="src/modules/settings.js"></script>
    <script src="src/modules/workshop_runtime.js"></script>
    <script src="src/modules/mode_rules.js"></script>
    <script src="src/modules/round_state.js"></script>
    <script src="src/modules/item_spawn.js"></script>
    <script src="src/modules/loop_timers.js"></script>
    <script src="src/modules/play_state.js"></script>
    <script src="src/modules/leaderboard.js"></script>
    <script src="src/modules/season.js"></script>
    <script src="src/modules/events.js"></script>
    <script src="src/modules/recap.js"></script>
    <script src="src/modules/records.js"></script>
    <script src="src/modules/endgame_flow.js"></script>
    <script src="src/modules/reset_prepare.js"></script>
    <script src="src/modules/reset_flow.js"></script>
    <script src="src/modules/input.js"></script>
    <script src="src/modules/render.js"></script>
    <script src="src/modules/settlement.js"></script>
    <script src="src/modules/guide.js"></script>
    <script src="src/modules/daily_rewards.js"></script>
    <script src="game.js"></script>
  </body>
</html>

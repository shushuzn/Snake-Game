# Snake 多文件网页游戏

这是一个**无需构建工具、无需安装依赖**的贪吃蛇网页项目，现已从单文件结构发展为多文件结构：

- `index.html`：页面结构与控件布局
- `styles.css`：样式与响应式布局
- `game.js`：游戏主逻辑与状态管理

## 当前能力（持续发展中）

- **5 种模式**：经典、限时 60 秒、冲刺 45 秒、无尽关卡、肉鸽模式。
- **多输入支持**：方向键、W/A/S/D、触屏方向键、滑动，以及快捷键（Space/P 暂停、R 重开、M 静音、H 帮助）。
- **道具与成长**：基础果、奖励果、护盾果、倍率果、时间果、冰冻果、相位果、王冠果、连击果。
- **系统机制**：障碍、硬核模式、连击、任务、成就、图鉴、高对比显示开关、精简HUD开关、失焦自动暂停开关、创意工坊规则分享、DLC 扩展包（狂热/守护/时序），以及障碍编辑器（坐标导入/导出）。
- **局外成长**：肉鸽词条 + 肉鸽点成长。
- **本地持久化**：设置、战绩、最佳分、模式记录、成就等数据保存在 `localStorage`。

## 目录结构

```text
.
├── index.html                                   # 页面结构
├── styles.css                                   # 页面样式
├── game.js                                      # 主编排入口（模块拼装）
├── challenge.js                                 # 每日挑战刷新与锁定逻辑
├── modes.js                                     # 模式配置/每日挑战/周主题
├── mode_rules.js                                # 模式规则与计时收益
├── round_state.js                               # 回合初始状态构建
├── item_spawn.js                                # 道具生成与障碍增量
├── loop_timers.js                               # 主循环与倒计时调度
├── play_state.js                                # 开始/暂停/继续状态机
├── endgame_flow.js                              # 结算触发编排
├── reset_prepare.js / reset_flow.js             # 重开前后置编排
├── workshop.js / workshop_runtime.js            # 工坊码与运行时应用
├── settings.js / storage.js / account.js        # 设置、存档、账号
├── render.js / input.js                         # 渲染与输入
├── README.md                                    # 项目说明
└── skills/snake-feature-evolver/
    ├── SKILL.md
    ├── references/
    │   ├── modes-and-systems.md            # 引用索引（按需加载）
    │   ├── module-map.md                   # 模块归属与模式联动点
    │   ├── persistence-and-account.md      # 存储键与账号兼容清单
    │   └── integration-checklists.md       # 功能接入检查清单
    └── scripts/
        ├── bump_version.py                 # 同步版本号
        └── run_required_checks.sh          # 一键执行必跑检查
```

## 快速开始

```bash
python3 -m http.server 4173
# 浏览器访问 http://localhost:4173/index.html
```

也可直接打开 `index.html`，但建议优先使用本地静态服务器。

## 开发自检

### 1) 一键必跑检查（推荐）

```bash
bash skills/snake-feature-evolver/scripts/run_required_checks.sh
```

### 2) 手工检查（等价）

```bash
node --check $(git ls-files '*.js')
rg -n "styles.css|workshop.js|modes.js|input.js|render.js|game.js" index.html
git diff --check
```

## 版本维护

同步页面可见版本与 `GAME_VERSION`：

```bash
python3 skills/snake-feature-evolver/scripts/bump_version.py 0.95.0
```

## 最新进展

- v0.95.0：地图分享前校验增强，应用前可识别越界/重复/关键路径冲突并给出质量提示。
- v0.94.0：榜单扩展新增每日挑战榜与DLC分类榜筛选，支持按对局标签聚焦查看战绩。
- v0.93.0：活动规则包改为声明式配置（规则类型 + 参数），便于按日期段/周末快速扩展活动。
- v0.92.0：排行榜支持分维度筛选（综合榜/经典/限时/冲刺/无尽/肉鸽），榜单查看路径更聚焦。
- v0.91.0：新增连击里程奖励（x5 额外加分、x8 触发 4 秒倍率冲刺），强化中后期滚雪球节奏。
- v0.90.0：活动入口聚合与地图摘要首版上线，支持活动面板快速跳转与障碍危险度/推荐模式展示。

## 工作路线图

> 目标：在保持“纯前端、零依赖可运行”的前提下，以**可复玩性**、**可分享性**、**可运营性**三条主线持续迭代。

### 路线图重写（按能力域）

#### A. 玩法与挑战系统（Challenge / DLC / Event）
- **已完成**
  - ✅ 每日挑战跨天切换保护（进行中对局不强切规则）。
  - ✅ 周主题（工作日/周末）与挑战倍率安全收敛。
  - ✅ DLC 风险/收益可视化（HUD + 对比面板）。
  - ✅ 活动挑战包首版与赛季奖励联动预览。
  - ✅ 活动规则包扩展（新年/春节/黄金周/周末常驻）与倍率文案标准化。
- **已完成补充（v0.90）**
  - ✅ 活动入口聚合（版本事件 + 活动面板统一导航）。
- **已完成补充（v0.93）**
  - ✅ 活动规则可配置化（按规则类型与参数声明式扩展）。

#### B. 赛季与榜单系统（Leaderboard / Season）
- **已完成**
  - ✅ 本地 Top20 榜单与来源切换开关（远端占位 + 本地回退提示）。
  - ✅ 赛季信息区（剩余时间、赛季最佳、历史赛季）与奖励预览。
- **已完成补充（v0.89）**
  - ✅ 远端榜接口读链路接入（JSON 拉取 + 超时保护 + 本地回退）。
- **已完成补充（v0.92）**
  - ✅ 榜单分维度扩展（综合榜 + 模式榜筛选）。
- **已完成补充（v0.94）**
  - ✅ 榜单继续扩展（每日挑战榜 / DLC 分类榜）。
- **下一步（v0.96）**
  - ⏭ 榜单下一阶段：每日挑战榜细分与DLC榜奖励联动。

#### C. 分享与创作系统（MapCode / Workshop）
- **已完成**
  - ✅ 地图码 `SNKMAP1`（生成、应用、校验）。
  - ✅ 工坊码携带 `mapCode` 并支持一键应用。
- **已完成补充（v0.90）**
  - ✅ 地图摘要信息（障碍数量、覆盖率、危险度、推荐模式）。
- **已完成补充（v0.95）**
  - ✅ 分享前校验增强（超限障碍、重叠点、边界质量提示）。

#### D. 体验与复盘系统（Mobile / Recap）
- **已完成**
  - ✅ 滑动灵敏度可配置并持久化。
  - ✅ 最近一局复盘摘要 + 关键帧时间线。
- **下一步（v0.96）**
  - ⏭ 复盘建议路径提示（高风险转向、失误前状态提示）。
  - ⏭ 新手引导分层（基础操作 → 道具认知 → 模式策略）。

### 版本推进计划（重排）
- `v0.88`：✅ 活动规则包扩展（周末/节日）+ 活动文案/倍率说明统一（已完成）。
- `v0.89`：✅ 排行榜远端接口真实接入（读链路 + 降级回退）（已完成）。
- `v0.90`：✅ 活动入口聚合 + 地图摘要信息首版（已完成）。
- `v0.91`：✅ 连击里程奖励（x5 额外加分 / x8 倍率冲刺）与节奏强化（已完成）。
- `v0.92`：✅ 榜单分维度扩展（综合榜 + 模式榜筛选）（已完成）。
- `v0.93`：✅ 活动规则可配置化（已完成）。
- `v0.94`：✅ 榜单继续扩展（每日挑战榜 / DLC 分类榜）（已完成）。
- `v0.95`：✅ 分享前校验增强（超限障碍、重叠点、边界质量提示）（已完成）。
- `v0.96`：复盘建议路径提示 + 新手引导分层首版。
- `v0.97`：新手引导分层与地图分享质量校验闭环。

### 路线图执行看板（滚动）
- **Now（进行中）**：`v0.96` 复盘建议路径提示 + 新手引导分层。
- **Next（下一步）**：`v0.97` 新手引导分层与地图分享质量校验闭环。
- **Later（随后）**：`v0.98` 创作与分享体验整合优化。

> 说明：看板每个版本完成后，都会同步写入“最新进展”。

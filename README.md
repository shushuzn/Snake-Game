# Snake 多文件网页游戏

这是一个**无需构建工具、无需安装依赖**的贪吃蛇网页项目，现已从单文件结构发展为多文件结构：

- `index.html`：页面结构与控件布局
- `styles.css`：样式与响应式布局
- `game.js`：游戏主逻辑与状态管理

## 当前能力（持续发展中）

- **5 种模式**：经典、限时 60 秒、冲刺 45 秒、无尽关卡、肉鸽模式。
- **多输入支持**：方向键、W/A/S/D、触屏方向键、滑动，以及快捷键（Space/P 暂停、R 重开、M 静音、H 帮助）。
- **道具与成长**：基础果、奖励果、护盾果、倍率果、时间果、冰冻果、相位果、王冠果、连击果。
- **系统机制**：障碍、硬核模式、连击、任务、成就、图鉴、高对比显示开关、精简HUD开关、失焦自动暂停开关、创意工坊规则分享、DLC 扩展包（狂热/守护/时序），以及障碍编辑器（坐标导入/导出）。
- **局外成长**：肉鸽词条 + 肉鸽点成长。
- **本地持久化**：设置、战绩、最佳分、模式记录、成就等数据保存在 `localStorage`。

## 目录结构

```text
.
├── index.html                                   # 页面结构
├── styles.css                                   # 页面样式
├── game.js                                      # 游戏主逻辑
├── workshop.js                                  # 创意工坊模块
├── modes.js                                     # 模式配置与每日挑战模块
├── input.js                                     # 输入控制模块（键盘/触屏）
├── render.js                                    # 渲染模块（棋盘/蛇/道具）
├── README.md                                    # 项目说明
└── skills/snake-feature-evolver/
    ├── SKILL.md
    ├── references/modes-and-systems.md
    └── scripts/bump_version.py
```

## 快速开始

```bash
python3 -m http.server 4173
# 浏览器访问 http://localhost:4173/index.html
```

也可直接打开 `index.html`，但建议优先使用本地静态服务器。

## 开发自检

### 1) JavaScript 语法检查

```bash
node --check game.js
```

### 2) HTML/CSS/JS 资源引用检查（快速）

```bash
rg -n "styles.css|workshop.js|modes.js|input.js|render.js|game.js" index.html
```

### 3) Git 空白与冲突标记检查

```bash
git diff --check
```

## 版本维护

同步页面可见版本与 `GAME_VERSION`：

```bash
python3 skills/snake-feature-evolver/scripts/bump_version.py 0.69.0
```

## 最新进展

- v0.69.0：新增 `endgame_flow.js`，拆分结算触发（连胜/最佳/成就/肉鸽收益/结束弹层）编排逻辑。
- v0.69.0：新增 `records.js`，拆分上局结果与最近战绩写入/渲染编排逻辑。
- v0.68.0：新增 `play_state.js`，拆分开局/继续/暂停状态机决策编排逻辑。
- v0.67.0：新增 `loop_timers.js`，拆分主循环与倒计时计时器编排逻辑。
- v0.66.0：新增 `item_spawn.js`，拆分道具生成与加石头规则编排逻辑。
- v0.65.0：新增 `round_state.js`，拆分回合初始化状态与出生参数编排逻辑。
- v0.64.0：新增 `mode_rules.js`，拆分限时模式与 DLC 时间/步进规则编排逻辑。
- v0.63.0：新增 `workshop_runtime.js`，拆分工坊快照与按钮交互编排逻辑。

## 工作路线图

### P0（当前迭代，1-2 周）
- ✅ 稳定每日挑战与 DLC 共存逻辑：已覆盖强制模式/锁定开关在跨天与重置场景的一致性。
- ✅ 为 `blitz` / 限时类模式增加细粒度结算面板：已支持加时来源 + 得分来源拆分。
- ✅ 统一创意工坊与本地设置字段演进策略：已新增 `schemaVersion` 与迁移逻辑，兼容旧配置并自动补齐关键字段。

### P1（中期，2-4 周）
- ⏳ 继续拆分 `game.js`：已拆出结算系统、挑战系统、存档能力、账号/设置/工坊/模式规则/战局状态/道具生成/主循环计时/状态机决策编排模块，并完成配置校验去冗余；下一步拆分重置收尾编排层（reset + HUD 收口）。
- DLC 体系扩展：新增“风险收益型”DLC，并提供可视化规则摘要。
- 增加每日挑战“周循环主题”（例如周末双倍率、工作日稳态挑战）。

### P2（长期，1-2 月）
- 排行榜与赛季系统（可选后端）：支持模式榜、挑战榜、DLC 分类榜。
- 地图/障碍编辑器升级为可分享地图码并与创意工坊打通。
- 完善移动端交互与新手引导（分层教程、动态提示、触屏手势自定义）。

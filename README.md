# Snake 多文件网页游戏

这是一个**无需构建工具、无需安装依赖**的贪吃蛇网页项目，现已从单文件结构发展为多文件结构：

- `index.html`：页面结构与控件布局
- `styles.css`：样式与响应式布局
- `game.js`：游戏主逻辑与状态管理

## 当前能力（持续发展中）

- **5 种模式**：经典、限时 60 秒、冲刺 45 秒、无尽关卡、肉鸽模式。
- **多输入支持**：方向键、W/A/S/D、触屏方向键、滑动，以及快捷键（Space/P 暂停、R 重开、M 静音、H 帮助）。
- **道具与成长**：基础果、奖励果、护盾果、倍率果、时间果、冰冻果、相位果、王冠果、连击果。
- **系统机制**：障碍、硬核模式、连击、任务、成就、图鉴、高对比显示开关、精简HUD开关、失焦自动暂停开关、创意工坊规则分享、DLC 扩展包（狂热/守护/时序），以及障碍编辑器（坐标导入/导出）。
- **局外成长**：肉鸽词条 + 肉鸽点成长。
- **本地持久化**：设置、战绩、最佳分、模式记录、成就等数据保存在 `localStorage`。

## 目录结构

```text
.
├── index.html                                   # 页面结构
├── styles.css                                   # 页面样式
├── game.js                                      # 主编排入口（模块拼装）
├── challenge.js                                 # 每日挑战刷新与锁定逻辑
├── modes.js                                     # 模式配置/每日挑战/周主题
├── mode_rules.js                                # 模式规则与计时收益
├── round_state.js                               # 回合初始状态构建
├── item_spawn.js                                # 道具生成与障碍增量
├── loop_timers.js                               # 主循环与倒计时调度
├── play_state.js                                # 开始/暂停/继续状态机
├── endgame_flow.js                              # 结算触发编排
├── reset_prepare.js / reset_flow.js             # 重开前后置编排
├── workshop.js / workshop_runtime.js            # 工坊码与运行时应用
├── settings.js / storage.js / account.js        # 设置、存档、账号
├── render.js / input.js                         # 渲染与输入
├── README.md                                    # 项目说明
└── skills/snake-feature-evolver/
    ├── SKILL.md
    ├── references/
    │   ├── modes-and-systems.md            # 引用索引（按需加载）
    │   ├── module-map.md                   # 模块归属与模式联动点
    │   ├── persistence-and-account.md      # 存储键与账号兼容清单
    │   └── integration-checklists.md       # 功能接入检查清单
    └── scripts/
        ├── bump_version.py                 # 同步版本号
        └── run_required_checks.sh          # 一键执行必跑检查
```

## 快速开始

```bash
python3 -m http.server 4173
# 浏览器访问 http://localhost:4173/index.html
```

也可直接打开 `index.html`，但建议优先使用本地静态服务器。

## 开发自检

### 1) 一键必跑检查（推荐）

```bash
bash skills/snake-feature-evolver/scripts/run_required_checks.sh
```

### 2) 手工检查（等价）

```bash
node --check $(git ls-files '*.js')
rg -n "styles.css|workshop.js|modes.js|input.js|render.js|game.js" index.html
git diff --check
```

## 版本维护

同步页面可见版本与 `GAME_VERSION`：

```bash
python3 skills/snake-feature-evolver/scripts/bump_version.py 0.92.0
```

## 最新进展

- v0.92.0：排行榜支持分维度筛选（综合榜/经典/限时/冲刺/无尽/肉鸽），榜单查看路径更聚焦。
- v0.91.0：新增连击里程奖励（x5 额外加分、x8 触发 4 秒倍率冲刺），强化中后期滚雪球节奏。
- v0.90.0：活动入口聚合与地图摘要首版上线，支持活动面板快速跳转与障碍危险度/推荐模式展示。
- v0.89.0：排行榜远端读取链路上线，支持远端 JSON 拉取、超时保护与失败自动回退本地。
- v0.88.0：活动规则包扩展上线，新增新年/春节/黄金周/周末常驻活动并统一倍率文案说明。
- v0.87.0：新增赛季奖励预览，并与当前活动挑战包联动展示奖励加成。
- v0.86.0：对局复盘新增关键帧时间线（最近 8 条），支持展示开局、进食里程碑与升级节点。
- v0.85.0：新增排行榜来源切换开关（本地榜/远端榜占位），离线场景可提示“远端榜回退本地”。
- v0.84.0：新增活动挑战包面板（节日主题首版），支持活动得分加成展示与结算标签。
- v0.83.0：新增对局复盘摘要面板（最近一局），展示终局原因、连击、进食、关卡与剩余时间等关键指标。
- v0.82.0：新增 DLC 风险收益对比面板，并上线风险收益型二阶段规则（狂热扩展护盾上限=1）。
- v0.81.0：新增滑动灵敏度设置（12/18/24/32px），移动端手势判定阈值可持久化配置，并支持工坊码同步。
- v0.80.0：新增赛季信息区与历史赛季入口（最近 6 期），支持月赛季剩余时间与赛季最佳展示。
- v0.79.0：新增本地排行榜（Top 20）面板，按分数/时间排序并持久化，支持清档联动重置。
- v0.78.0：创意工坊规则码新增 `mapCode` 字段，支持“规则 + 地图”一键分享与应用。
- v0.77.0：障碍编辑器新增地图码（`SNKMAP1`）生成与应用，支持校验码验证与错误提示。
- v0.76.0：挑战面板刷新改为复用 `getDailyChallengeBundle`，统一当前/明日挑战与日期推导，减少重复逻辑。
- v0.75.0：优化每日挑战跨天切换：进行中的对局将保持当局挑战，避免午夜切日导致规则突变；并增加跨天切换提示。
- v0.74.0：优化每日挑战刷新的一致性（今日/明日基于同一时间快照生成），并为周主题得分倍率增加安全校验与上限保护。
- v0.73.0：每日挑战新增“周循环主题”（工作日稳态 / 周末双倍率），并将周主题规则合并进挑战说明与得分结算。
- v0.72.0：DLC 状态栏新增“风险/收益”规则摘要提示（hover 可见），帮助开局前快速决策。
- v0.71.0：新增 `reset_prepare.js`，拆分重置前置（spawn + roundMeta 组装）编排逻辑。
- v0.70.0：新增 `reset_flow.js`，拆分重置收尾（计时器停止/HUD复位/开局提示）编排逻辑。
- v0.69.1：修复 `effectiveSpeed` 与 `refreshStateText` 缺失导致无法开局/运行的阻塞问题。
- v0.69.0：新增 `endgame_flow.js`，拆分结算触发（连胜/最佳/成就/肉鸽收益/结束弹层）编排逻辑。
- v0.69.0：新增 `records.js`，拆分上局结果与最近战绩写入/渲染编排逻辑。
- v0.68.0：新增 `play_state.js`，拆分开局/继续/暂停状态机决策编排逻辑。
- v0.67.0：新增 `loop_timers.js`，拆分主循环与倒计时计时器编排逻辑。
- v0.66.0：新增 `item_spawn.js`，拆分道具生成与加石头规则编排逻辑。

## 工作路线图

> 目标：在保持“纯前端、零依赖可运行”的前提下，以**可复玩性**、**可分享性**、**可运营性**三条主线持续迭代。

### 路线图重写（按能力域）

#### A. 玩法与挑战系统（Challenge / DLC / Event）
- **已完成**
  - ✅ 每日挑战跨天切换保护（进行中对局不强切规则）。
  - ✅ 周主题（工作日/周末）与挑战倍率安全收敛。
  - ✅ DLC 风险/收益可视化（HUD + 对比面板）。
  - ✅ 活动挑战包首版与赛季奖励联动预览。
  - ✅ 活动规则包扩展（新年/春节/黄金周/周末常驻）与倍率文案标准化。
- **已完成补充（v0.90）**
  - ✅ 活动入口聚合（版本事件 + 活动面板统一导航）。
- **下一步（v0.93）**
  - ⏭ 活动规则可配置化（按日期段与标签声明式扩展）。

#### B. 赛季与榜单系统（Leaderboard / Season）
- **已完成**
  - ✅ 本地 Top20 榜单与来源切换开关（远端占位 + 本地回退提示）。
  - ✅ 赛季信息区（剩余时间、赛季最佳、历史赛季）与奖励预览。
- **已完成补充（v0.89）**
  - ✅ 远端榜接口读链路接入（JSON 拉取 + 超时保护 + 本地回退）。
- **已完成补充（v0.92）**
  - ✅ 榜单分维度扩展（综合榜 + 模式榜筛选）。
- **下一步（v0.93）**
  - ⏭ 榜单继续扩展（每日挑战榜 / DLC 分类榜）。

#### C. 分享与创作系统（MapCode / Workshop）
- **已完成**
  - ✅ 地图码 `SNKMAP1`（生成、应用、校验）。
  - ✅ 工坊码携带 `mapCode` 并支持一键应用。
- **已完成补充（v0.90）**
  - ✅ 地图摘要信息（障碍数量、覆盖率、危险度、推荐模式）。
- **下一步（v0.93）**
  - ⏭ 分享前校验增强（超限障碍、重叠点、边界质量提示）。

#### D. 体验与复盘系统（Mobile / Recap）
- **已完成**
  - ✅ 滑动灵敏度可配置并持久化。
  - ✅ 最近一局复盘摘要 + 关键帧时间线。
- **下一步（v0.94）**
  - ⏭ 复盘建议路径提示（高风险转向、失误前状态提示）。
  - ⏭ 新手引导分层（基础操作 → 道具认知 → 模式策略）。

### 版本推进计划（重排）
- `v0.88`：✅ 活动规则包扩展（周末/节日）+ 活动文案/倍率说明统一（已完成）。
- `v0.89`：✅ 排行榜远端接口真实接入（读链路 + 降级回退）（已完成）。
- `v0.90`：✅ 活动入口聚合 + 地图摘要信息首版（已完成）。
- `v0.91`：✅ 连击里程奖励（x5 额外加分 / x8 倍率冲刺）与节奏强化（已完成）。
- `v0.92`：✅ 榜单分维度扩展（综合榜 + 模式榜筛选）（已完成）。
- `v0.93`：活动规则可配置化 + 榜单继续扩展（每日挑战榜 / DLC 分类榜）。
- `v0.94`：复盘建议路径提示 + 新手引导分层首版。

### 路线图执行看板（滚动）
- **Now（进行中）**：`v0.93` 活动规则可配置化 + 榜单继续扩展（每日挑战榜 / DLC 分类榜）。
- **Next（下一步）**：`v0.94` 复盘建议路径提示 + 新手引导分层。
- **Later（随后）**：`v0.95` 新手引导分层与地图分享质量校验。

> 说明：看板每个版本完成后，都会同步写入“最新进展”。

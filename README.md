# Snake 多文件网页游戏

这是一个**无需构建工具、无需安装依赖**的贪吃蛇网页项目，现已从单文件结构发展为多文件结构：

- `index.html`：页面结构与控件布局
- `styles.css`：样式与响应式布局
- `game.js`：游戏主逻辑与状态管理

## 当前能力（持续发展中）

- **5 种模式**：经典、限时 60 秒、冲刺 45 秒、无尽关卡、肉鸽模式。
- **多输入支持**：方向键、W/A/S/D、触屏方向键、滑动，以及快捷键（Space/P 暂停、R 重开、M 静音、H 帮助）。
- **道具与成长**：基础果、奖励果、护盾果、倍率果、时间果、冰冻果、相位果、王冠果、连击果。
- **系统机制**：障碍、硬核模式、连击、任务、成就、图鉴、高对比显示开关、精简HUD开关、失焦自动暂停开关、创意工坊规则分享、DLC 扩展包（狂热/守护/时序），以及障碍编辑器（坐标导入/导出）。
- **局外成长**：肉鸽词条 + 肉鸽点成长。
- **本地持久化**：设置、战绩、最佳分、模式记录、成就等数据保存在 `localStorage`。

## 目录结构

```text
.
├── index.html                                   # 页面结构
├── styles.css                                   # 页面样式
├── game.js                                      # 游戏主逻辑
├── workshop.js                                  # 创意工坊模块
├── modes.js                                     # 模式配置与每日挑战模块
├── input.js                                     # 输入控制模块（键盘/触屏）
├── render.js                                    # 渲染模块（棋盘/蛇/道具）
├── README.md                                    # 项目说明
└── skills/snake-feature-evolver/
    ├── SKILL.md
    ├── references/modes-and-systems.md
    └── scripts/bump_version.py
```

## 快速开始

```bash
python3 -m http.server 4173
# 浏览器访问 http://localhost:4173/index.html
```

也可直接打开 `index.html`，但建议优先使用本地静态服务器。

## 开发自检

### 1) JavaScript 语法检查

```bash
node --check game.js
```

### 2) HTML/CSS/JS 资源引用检查（快速）

```bash
rg -n "styles.css|workshop.js|modes.js|input.js|render.js|game.js" index.html
```

### 3) Git 空白与冲突标记检查

```bash
git diff --check
```

## 版本维护

同步页面可见版本与 `GAME_VERSION`：

```bash
python3 skills/snake-feature-evolver/scripts/bump_version.py 0.58.0
```

## 最新进展

- v0.58.0：统一存档 JSON 读写入口，减少重复解析与异常分支。
- v0.57.0：设置校验逻辑常量化，减少重复分支并提升可维护性。
- v0.56.0：结算统计逻辑拆分到 `settlement.js`，并启动路线图 P1 模块化工作。
- v0.55.0：设置系统新增 schema 迁移流程，兼容历史配置并自动补齐 DLC 字段。
- v0.54.0：结算面板新增得分来源拆分，并更新路线图阶段进度。
- v0.53.0：新增最近一局结算明细面板（含限时加时来源），便于复盘。
- v0.52.0：HUD 新增 DLC 状态与效果提示，当前扩展规则更直观。
- v0.51.0：新增 DLC「时序扩展」，为限时与冲刺模式提供额外时间增益。
- v0.50.0：新增 DLC 扩展包（狂热/守护），并支持工坊与设置同步。
- v0.49.0：修复强制模式挑战在进行中对局的切换时机，并校正重置时的计时初始化顺序。
- v0.48.0：新增“冲刺日”每日挑战，并在模式锁定期间保留玩家原始模式偏好。
- v0.47.0：新增“冲刺 45 秒”模式，适合短局冲分。
- v0.46.0：修复挑战锁定期间保存设置会覆盖障碍偏好的问题。
- v0.45.0：净空挑战会临时锁定障碍开关并在挑战结束后恢复玩家原始偏好。
- v0.44.0：每日挑战会锁定冲突规则开关，净空模式下障碍开关自动禁用并提示原因。
- v0.43.0：优化挑战倒计时刷新策略，减少无效 DOM 更新并统一刷新定时器。
- v0.42.0：新增明日日期展示，挑战日期增加星期信息。
- v0.41.0：每日挑战支持跨天自动刷新，并新增挑战日期显示。
- v0.40.0：每日挑战改为本地日期计算，并新增挑战刷新倒计时显示。
- v0.39.0：HUD 新增“明日挑战”预告，并补全每日挑战选择逻辑。
- v0.38.0：新增障碍编辑器，支持坐标导入/导出/清空，并可持久化自定义障碍布局。
- v0.37.0：新增每日挑战效果展示与新手引导入口，帮助玩家更快理解当日规则。
- v0.36.0：继续拆分 `game.js`，新增 `modes.js` / `input.js` / `render.js` 三个模块，主文件更聚焦。
- v0.35.0：新增快捷键（R 重开 / M 静音 / H 帮助），并避免输入框聚焦时误触快捷键。
- v0.34.0：创意工坊进一步文件模块化，拆分为独立 `workshop.js`。
- v0.33.2：创意工坊逻辑模块化，统一预设与分享码应用入口。
- v0.33.1：创意工坊新增预设模板，可一键应用三种规则组合。
- v0.32.2：新增失焦自动暂停开关，可按习惯关闭后台自动暂停。
- v0.32.1：新增精简HUD开关，移动端阅读更聚焦，且偏好可持久化。
- v0.32.0：重写前端布局与视觉层次，保留原有玩法系统与存档兼容。

## 工作路线图

### P0（当前迭代，1-2 周）
- ✅ 稳定每日挑战与 DLC 共存逻辑：已覆盖强制模式/锁定开关在跨天与重置场景的一致性。
- ✅ 为 `blitz` / 限时类模式增加细粒度结算面板：已支持加时来源 + 得分来源拆分。
- ✅ 统一创意工坊与本地设置字段演进策略：已新增 `schemaVersion` 与迁移逻辑，兼容旧配置并自动补齐关键字段。

### P1（中期，2-4 周）
- ⏳ 继续拆分 `game.js`：已拆出结算系统、配置校验去冗余、存档读写去冗余；下一步拆分挑战系统与独立存档模块。
- DLC 体系扩展：新增“风险收益型”DLC，并提供可视化规则摘要。
- 增加每日挑战“周循环主题”（例如周末双倍率、工作日稳态挑战）。

### P2（长期，1-2 月）
- 排行榜与赛季系统（可选后端）：支持模式榜、挑战榜、DLC 分类榜。
- 地图/障碍编辑器升级为可分享地图码并与创意工坊打通。
- 完善移动端交互与新手引导（分层教程、动态提示、触屏手势自定义）。
